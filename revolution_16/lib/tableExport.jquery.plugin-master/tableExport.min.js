(function(e){e.fn.extend({tableExport:function(p){function t(m,d,f,g){e(m).filter(":visible").find(d).each(function(m){if("none"!=e(this).css("display")&&"none"!=e(this).data("tableexport-display")&&-1==a.ignoreColumn.indexOf(m)&&"function"===typeof g){var d=0;if("undefined"!=typeof w[f]&&0<w[f].length)for(c=0;c<=m;c++)"undefined"!=typeof w[f][c]&&(g(null,f,c),delete w[f][c],m++);g(this,f,m);if(e(this).is("[colspan]"))for(d=e(this).attr("colspan"),c=0;c<d-1;c++)g(null,f,m+c);if(e(this).is("[rowspan]")){var b=
parseInt(e(this).attr("rowspan"));for(r=1;r<b;r++)for("undefined"==typeof w[f+r]&&(w[f+r]=[]),w[f+r][m]="",c=1;c<d;c++)w[f+r][m+c]=""}}})}function H(m){!0===a.consoleLog&&console.log(m.output());if("string"==a.outputMode)return m.output();if("base64"==a.outputMode)return x(m.output());try{var d=m.output("blob");saveAs(d,a.fileName+".pdf")}catch(f){y(a.fileName+".pdf","data:application/pdf;base64,"+x(m.output()))}}function I(m,d,f){var g="";if(null!=m)if(d=u(m,d,f),m=null===d||""==d?"":d.toString(),
d instanceof Date)g=a.csvEnclosure+d.toLocaleString()+a.csvEnclosure;else if(d=a.csvEnclosure+a.csvEnclosure,g=m.replace(new RegExp(a.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),d),0<=g.indexOf(a.csvSeparator)||/[\r\n ]/g.test(g))g=a.csvEnclosure+g+a.csvEnclosure;return g}function u(m,d,f){var g="";null!=m&&(m=e(m),g=!0===a.htmlContent?m.html().trim():m.text().trim().replace(/\u00AD/g,""),!0===a.escape&&(g=escape(g)),"function"===typeof a.onCellData&&(g=a.onCellData(m,d,f,g)));
return g}function N(a,d,f){return d+"-"+f.toLowerCase()}function E(a,d){return window.getComputedStyle?(d=d.replace(/([a-z])([A-Z])/,N),window.getComputedStyle(a,null).getPropertyValue(d)):a.currentStyle?a.currentStyle[d]:a.style[d]}function F(a,d,f){d=E(a,d).match(/\d+/);if(null!==d){d=d[0];var g=document.createElement("div");g.style.overflow="hidden";g.style.visibility="hidden";a.parentElement.appendChild(g);g.style.width=100+f;f=100/g.offsetWidth;a.parentElement.removeChild(g);return d*f}return 0}
function y(a,d){var f=document.createElement("a");if(f){document.body.appendChild(f);f.style="display: none";f.download=a;f.href=d;if(document.createEvent)null==A&&(A=document.createEvent("MouseEvents")),A.initEvent("click",!0,!1),f.dispatchEvent(A);else if(document.createEventObject)f.fireEvent("onclick");else if("function"==typeof f.onclick)f.onclick();document.body.removeChild(f)}}function x(a){var d="",f,g,b,e,h,k,l=0;a=a.replace(/\x0d\x0a/g,"\n");g="";for(b=0;b<a.length;b++)e=a.charCodeAt(b),
128>e?g+=String.fromCharCode(e):(127<e&&2048>e?g+=String.fromCharCode(e>>6|192):(g+=String.fromCharCode(e>>12|224),g+=String.fromCharCode(e>>6&63|128)),g+=String.fromCharCode(e&63|128));for(a=g;l<a.length;)f=a.charCodeAt(l++),g=a.charCodeAt(l++),b=a.charCodeAt(l++),e=f>>2,f=(f&3)<<4|g>>4,h=(g&15)<<2|b>>6,k=b&63,isNaN(g)?h=k=64:isNaN(b)&&(k=64),d=d+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return d}var a={csvSeparator:",",csvEnclosure:'"',consoleLog:!1,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8,
tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},onCellData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"};p=e.extend(!0,a,p);var A=null,w=[];if("csv"==a.type||"txt"==a.type){var h="",n=0;e(this).find("thead").first().find(a.theadSelector).each(function(){h+="\n";t(this,"th,td",n,function(m,d,f){h+=I(m,d,f)+a.csvSeparator});n++;h=e.trim(h);h=e.trim(h).substring(0,h.length-1)});e(this).find("tbody").first().find(a.tbodySelector).each(function(){trData=
"";t(this,"td",n,function(m,d,f){trData+=I(m,d,f)+a.csvSeparator});trData.length>a.csvSeparator.length&&(h+="\n"+trData);n++;h=e.trim(h).substring(0,h.length-1)});h+="\n";!0===a.consoleLog&&console.log(h);if("string"==a.outputMode)return h;if("base64"==a.outputMode)return x(h);try{var v=new Blob([("csv"==a.type?"\ufeff":"")+h],{type:"text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8"});saveAs(v,a.fileName+"."+a.type)}catch(O){y(a.fileName+"."+a.type,"data:text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8,"+
("csv"==a.type?"\ufeff":"")+encodeURIComponent(h))}}else if("sql"==a.type){n=0;h="INSERT INTO `"+a.tableName+"` (";e(this).find("thead").first().find(a.theadSelector).each(function(){t(this,"th,td",n,function(a,d,f){h+="'"+u(a,d,f)+"',"});n++;h=e.trim(h);h=e.trim(h).substring(0,h.length-1)});h+=") VALUES ";e(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";t(this,"td",n,function(a,d,f){trData+="'"+u(a,d,f)+"',"});3<trData.length&&(h+="("+trData,h=e.trim(h).substring(0,h.length-
1),h+="),");n++});h=e.trim(h).substring(0,h.length-1);h+=";";!0===a.consoleLog&&console.log(h);if("string"==a.outputMode)return h;if("base64"==a.outputMode)return x(h);try{v=new Blob([h],{type:"text/plain;charset=utf-8"}),saveAs(v,a.fileName+".sql")}catch(P){y(a.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(h))}}else if("json"==a.type){var J=[];e(this).find("thead").first().find(a.theadSelector).each(function(){var a=[],d=0;t(this,"th,td",d,function(d,g,b){a.push(u(d,g,
b))});J.push(a);d++});var K=[];e(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=[];t(this,"td",n,function(d,f,g){a.push(u(d,f,g))});0<a.length&&(1!=a.length||""!=a[0])&&K.push(a);n++});p=[];p.push({header:J,data:K});var b=JSON.stringify(p);!0===a.consoleLog&&console.log(b);if("string"==a.outputMode)return b;p=x(b);if("base64"==a.outputMode)return p;try{v=new Blob([b],{type:"application/json;charset=utf-8"}),saveAs(v,a.fileName+".json")}catch(Q){y(a.fileName+".json","data:application/json;charset=utf-8;base64,"+
p)}}else if("xml"==a.type){var n=0,q='<?xml version="1.0" encoding="utf-8"?>',q=q+"<tabledata><fields>";e(this).find("thead").first().find(a.theadSelector).each(function(){t(this,"th,td",n,function(a,d,f){q+="<field>"+u(a,d,f)+"</field>"});n++});var q=q+"</fields><data>",B=1;e(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=1,d="";t(this,"td",n,function(f,g,b){d+="<column-"+a+">"+u(f,g,b)+"</column-"+a+">";a++});"<column-1></column-1>"!=d&&(q+='<row id="'+B+'">'+d+"</row>",
B++);n++});q+="</data></tabledata>";!0===a.consoleLog&&console.log(q);if("string"==a.outputMode)return q;p=x(q);if("base64"==a.outputMode)return p;try{v=new Blob([q],{type:"application/xml;charset=utf-8"}),saveAs(v,a.fileName+".xml")}catch(R){y(a.fileName+".xml","data:application/xml;charset=utf-8;base64,"+p)}}else if("excel"==a.type||"doc"==a.type){var n=0,k="<table>";e(this).find("thead").first().find(a.theadSelector).each(function(){k+="<tr>";t(this,"th,td",n,function(b,d,f){if(null!=b){k+="<td style='";
for(var g in a.excelstyles)a.excelstyles.hasOwnProperty(g)&&(k+=a.excelstyles[g]+": "+e(b).css(a.excelstyles[g])+";");k+="'>"+u(b,d,f)+"</td>"}});n++;k+="</tr>"});B=1;e(this).find("tbody").first().find(a.tbodySelector).each(function(){k+="<tr>";t(this,"td",n,function(b,d,f){if(null!=b){k+="<td style='";for(var g in a.excelstyles)a.excelstyles.hasOwnProperty(g)&&(k+=a.excelstyles[g]+": "+e(b).css(a.excelstyles[g])+";");e(b).is("[colspan]")&&(k+="' colspan='"+e(b).attr("colspan"));e(b).is("[rowspan]")&&
(k+="' rowspan='"+e(b).attr("rowspan"));k+="'>"+u(b,d,f)+"</td>"}});B++;n++;k+="</tr>"});a.displayTableName&&(k+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+u(e("<p>"+a.tableName+"</p>"))+"</td></tr>");k+="</table>";!0===a.consoleLog&&console.log(k);b="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+a.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";b+='<meta http-equiv="content-type" content="application/vnd.ms-'+a.type+'; charset=UTF-8">';
b=b+'<meta http-equiv="content-type" content="application/'+("excel"==a.type?"vnd.ms-excel":"msword");b+='; charset=UTF-8">';b+="<head>";"excel"==a.type&&(b+="\x3c!--[if gte mso 9]>",b+="<xml>",b+="<x:ExcelWorkbook>",b+="<x:ExcelWorksheets>",b+="<x:ExcelWorksheet>",b+="<x:Name>",b+=a.worksheetName,b+="</x:Name>",b+="<x:WorksheetOptions>",b+="<x:DisplayGridlines/>",b+="</x:WorksheetOptions>",b+="</x:ExcelWorksheet>",b+="</x:ExcelWorksheets>",b+="</x:ExcelWorkbook>",b+="</xml>",b+="<![endif]--\x3e");
b+="</head>";b+="<body>";b+=k;b+="</body>";b+="</html>";if("string"==a.outputMode)return b;p=x(b);if("base64"==a.outputMode)return p;var L="excel"==a.type?"xls":"doc";try{v=new Blob([b],{type:"application/vnd.ms-"+a.type}),saveAs(v,a.fileName+"."+L)}catch(S){y(a.fileName+"."+L,"data:application/vnd.ms-"+a.type+";base64,"+p)}}else if("png"==a.type)html2canvas(e(this),{onrendered:function(b){b=b.toDataURL();b=b.substring(22);for(var d=atob(b),f=new ArrayBuffer(d.length),g=new Uint8Array(f),e=0;e<d.length;e++)g[e]=
d.charCodeAt(e);try{var h=new Blob([f],{type:"image/png"});saveAs(h,a.fileName+".png")}catch(k){y(a.fileName+".png","data:image/png;base64,"+b)}}});else if("pdf"==a.type)if(!1===a.jspdf.autotable){p={dim:{w:F(e(this).first().get(0),"width","mm"),h:F(e(this).first().get(0),"height","mm")},pagesplit:!1};var G=new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);G.addHTML(e(this).first(),a.jspdf.margins.left,a.jspdf.margins.top,p,function(){H(G)});delete G}else{var l=a.jspdf.autotable.tableExport;
if("string"===typeof a.jspdf.format&&"bestfit"==a.jspdf.format.toLowerCase()){var C={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},D="",z="",M=0;e(this).filter(":visible").each(function(){if("none"!=e(this).css("display")){var a=F(e(this).get(0),"width","pt");if(a>M){a>C.a0[0]&&(D="a0",z="l");for(var b in C)C[b][1]>a&&(D=b,z="l",C[b][0]>a&&(z="p"));M=a}}});a.jspdf.format=""==D?"a4":D;a.jspdf.orientation=""==z?"w":z}l.doc=new jsPDF(a.jspdf.orientation,
a.jspdf.unit,a.jspdf.format);e(this).filter(":visible").each(function(){if("none"!=e(this).css("display")){var b=0,d={};l.columns=[];l.rows=[];if("function"===typeof l.onTable&&!1===l.onTable(e(this),a))return!0;Object.keys(a.jspdf.autotable).forEach(function(b){d[b]=a.jspdf.autotable[b]});d.margins={};e.extend(!0,d.margins,a.jspdf.margins);"function"!==typeof d.renderCell&&(d.renderCell=function(a,b,d,e,h,k,m,l){var n=l.tableExport.doc,p=0;n.setFillColor(0===m%2?245:255);n.setTextColor(50);n.rect(a,
b,d,e,"F");b+=l.lineHeight/2+n.autoTableTextHeight()/2-2.5;"undefined"!=typeof l.tableExport.columns[h]&&(e=l.tableExport.columns[h],"right"==e.style.align?p=d-n.getStringUnitWidth(""+k)*n.internal.getFontSize()-l.padding:"center"==e.style.align&&(p=(d-n.getStringUnitWidth(""+k)*n.internal.getFontSize())/2));p<l.padding&&(p=l.padding);n.text(k,a+p,b)});e(this).find("thead").find(a.theadSelector).each(function(){var a=0;t(this,"th,td",b,function(b,d,e){b={title:u(b,d,e),key:a++,style:{align:E(b,"text-align"),
bcolor:E(b,"background-color")}};l.columns.push(b)});b++;a=0});e(this).find("tbody").find(a.tbodySelector).each(function(){var a=[];t(this,"td",b,function(b,d,e){a.push(u(b,d,e))});b++;l.rows.push(a)});if("function"===typeof l.onBeforeAutotable)l.onBeforeAutotable(e(this),l.columns,l.rows,d);l.doc.autoTable(l.columns,l.rows,d);if("function"===typeof l.onAfterAutotable)l.onAfterAutotable(e(this),d);a.jspdf.autotable.startY=l.doc.autoTableEndPosY()+d.margins.top}});H(l.doc);l.columns.length=0;l.rows.length=
0;delete l.doc;l.doc=null}return this}})})(jQuery);
